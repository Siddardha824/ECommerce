<!DOCTYPE html>
<html lang="en">
  <head>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <link href="../Shared/styles.css" rel="stylesheet" />
  </head>
  <body class="bgcol">
    <div
      class="uploadcont align-items-center vh-100 d-flex justify-content-center"
    >
      <form id="loginForm" class="login w-50">
        <div class="text-center">
          <h4>Login here</h4>
        </div>
        <input
          class="form-control mt-3"
          type="text"
          name="uname"
          placeholder="Enter user name"
          required
        />
        <input
          id="pass"
          class="form-control mt-2"
          type="password"
          name="upass"
          placeholder="Enter Password"
          required
        />
        <button type="submit" class="form-control mt-3 btn btn-success bagc">
          Login
        </button>
        <div class="text-center mt-2">
          Don't have an account?
          <a class="" href="register.html">Register Here</a>
        </div>
      </form>
    </div>

    <script>
      const form = document.getElementById("loginForm");

      form.addEventListener("submit", async function (e) {
        e.preventDefault();

        const formData = new FormData(form);

        try {
          const res = await fetch("login.php", {
            method: "POST",
            body: formData,
            datatype: "json",
          });
          console.log("Response", res);
          const contentType = res.headers.get("content-type");
          if (!contentType || !contentType.includes("application/json")) {
            const raw = await res.text();
            alert("Server error:\n" + raw);
            return;
          }

          const result = await res.json();

          if (result.success) {
            alert("Login successful!");
            window.location.href = result.message;
          } else {
            alert(result.message);
          }
        } catch (err) {
          alert("Network error. See console for details.");
          console.error(err);
        }
      });
    </script>
  </body>
</html>
